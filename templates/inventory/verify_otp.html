{% extends 'base.html' %} {% load static %} {% block title %}Verify Email -
PharmaTrack{% endblock %} {% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow">
        <div class="card-header bg-primary text-white text-center">
          <h3><i class="fas fa-shield-alt"></i> Email Verification</h3>
        </div>
        <div class="card-body">
          <div class="text-center mb-4">
            <i class="fas fa-envelope-open-text fa-3x text-primary mb-3"></i>
            <h5>Check Your Email</h5>
            <p class="text-muted">
              We've sent a 6-digit verification code to:<br />
              <strong>{{ user.email }}</strong>
            </p>
          </div>

          {% if messages %} {% for message in messages %}
          <div
            class="alert alert-{{ message.tags }} alert-dismissible fade show"
            role="alert"
          >
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
            ></button>
          </div>
          {% endfor %} {% endif %}

          <form method="post">
            {% csrf_token %}
            <div class="mb-3">
              <label for="otp_code" class="form-label">Verification Code</label>
              <input
                type="text"
                class="form-control form-control-lg text-center"
                id="otp_code"
                name="otp_code"
                placeholder="000000"
                maxlength="6"
                pattern="[0-9]{6}"
                required
                autocomplete="off"
              />
              <div class="form-text">
                Enter the 6-digit code from your email
              </div>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-check"></i> Verify Email
              </button>
            </div>
          </form>

          <hr />

          <div class="text-center">
            <p class="text-muted mb-2">Didn't receive the code?</p>
            <a
              href="{% url 'resend_otp' user.id %}"
              class="btn btn-outline-secondary"
            >
              <i class="fas fa-redo"></i> Resend Code
            </a>
          </div>

          <div class="alert alert-info mt-3">
            <small>
              <i class="fas fa-info-circle"></i>
              <strong>Note:</strong> The verification code expires in 10 minutes
              and you have 3 attempts.
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Auto-focus on OTP input
  document.getElementById("otp_code").focus();

  // Auto-submit when 6 digits are entered
  document.getElementById("otp_code").addEventListener("input", function (e) {
    if (e.target.value.length === 6) {
      // Optional: Auto-submit after a short delay
      setTimeout(() => {
        e.target.form.submit();
      }, 500);
    }
  });

  // Only allow numbers
  document
    .getElementById("otp_code")
    .addEventListener("keypress", function (e) {
      if (!/[0-9]/.test(e.key)) {
        e.preventDefault();
      }
    });
</script>
{% endblock %}
